<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Wheel Betting Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
        }
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid #4a5568;
            background-image: conic-gradient(
                #2d3748 0deg 7.2deg, #1a202c 7.2deg 14.4deg,
                #2d3748 14.4deg 21.6deg, #1a202c 21.6deg 28.8deg,
                #2d3748 28.8deg 36deg, #1a202c 36deg 43.2deg,
                #2d3748 43.2deg 50.4deg, #1a202c 50.4deg 57.6deg,
                #2d3748 57.6deg 64.8deg, #1a202c 64.8deg 72deg,
                #2d3748 72deg 79.2deg, #1a202c 79.2deg 86.4deg,
                #2d3748 86.4deg 93.6deg, #1a202c 93.6deg 100.8deg,
                #2d3748 100.8deg 108deg, #1a202c 108deg 115.2deg,
                #2d3748 115.2deg 122.4deg, #1a202c 122.4deg 129.6deg,
                #2d3748 129.6deg 136.8deg, #1a202c 136.8deg 144deg,
                #2d3748 144deg 151.2deg, #1a202c 151.2deg 158.4deg,
                #2d3748 158.4deg 165.6deg, #1a202c 165.6deg 172.8deg,
                #2d3748 172.8deg 180deg, #1a202c 180deg 187.2deg,
                #2d3748 187.2deg 194.4deg, #1a202c 194.4deg 201.6deg,
                #2d3748 201.6deg 208.8deg, #1a202c 208.8deg 216deg,
                #2d3748 216deg 223.2deg, #1a202c 223.2deg 230.4deg,
                #2d3748 230.4deg 237.6deg, #1a202c 237.6deg 244.8deg,
                #2d3748 244.8deg 252deg, #1a202c 252deg 259.2deg,
                #2d3748 259.2deg 266.4deg, #1a202c 266.4deg 273.6deg,
                #2d3748 273.6deg 280.8deg, #1a202c 280.8deg 288deg,
                #2d3748 288deg 295.2deg, #1a202c 295.2deg 302.4deg,
                #2d3748 302.4deg 309.6deg, #1a202c 309.6deg 316.8deg,
                #2d3748 316.8deg 324deg, #1a202c 324deg 331.2deg,
                #2d3748 331.2deg 338.4deg, #1a202c 338.4deg 345.6deg,
                #2d3748 345.6deg 352.8deg, #1a202c 352.8deg 360deg
            );
            transition: transform 5s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0 30px rgba(0,0,0,0.7), inset 0 0 25px rgba(0,0,0,0.5);
        }
        .wheel-number {
            position: absolute;
            width: 40px;
            height: 40px;
            top: 50%;
            left: 50%;
            margin-left: -20px; /* Half of element width */
            margin-top: -20px; /* Half of element height */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            border-radius: 50%;
            font-size: 1.1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .wheel-number.winner {
            background-color: #f59e0b !important; /* amber-500 */
            transform: translate(var(--tx), var(--ty)) scale(1.2) !important;
            box-shadow: 0 0 15px #f59e0b;
            color: #1a202c;
        }
        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 40px solid #e11d48; /* rose-600 */
            z-index: 10;
            filter: drop-shadow(0 -2px 3px rgba(0,0,0,0.5));
        }
        .number-grid-btn {
            transition: all 0.2s ease-in-out;
        }
        .number-grid-btn:hover {
            transform: translateY(-2px);
        }
        .number-grid-btn.selected {
            background-image: linear-gradient(to right, #2563eb, #3b82f6);
            color: white;
            border-color: #3b82f6;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
        }
        .message-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center;
            justify-content: center; z-index: 100; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .message-modal.visible { opacity: 1; pointer-events: auto; }
        
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(96, 165, 250, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(96, 165, 250, 0.8); }
        }
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 200;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen">
    <canvas id="confetti-canvas"></canvas>
    <!-- Authentication Section -->
    <div id="auth-container" class="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-lg">
        <div>
            <h2 id="auth-title" class="text-center text-3xl font-extrabold text-white">Sign in to your account</h2>
        </div>
        <form id="login-form" class="space-y-6">
             <div>
                <label for="login-email" class="sr-only">Email address</label>
                <input id="login-email" name="email" type="email" autocomplete="email" required class="w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Email address">
            </div>
            <div>
                <label for="login-password" class="sr-only">Password</label>
                <input id="login-password" name="password" type="password" autocomplete="current-password" required class="w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Password">
            </div>
            <div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 focus:ring-offset-gray-800">
                    Sign in
                </button>
            </div>
        </form>
        <form id="register-form" class="space-y-6 hidden">
             <div>
                <label for="register-email" class="sr-only">Email address</label>
                <input id="register-email" name="email" type="email" autocomplete="email" required class="w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Email address">
            </div>
            <div>
                <label for="register-password" class="sr-only">Password</label>
                <input id="register-password" name="password" type="password" autocomplete="new-password" required class="w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Password">
            </div>
            <div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 focus:ring-offset-gray-800">
                    Create Account
                </button>
            </div>
        </form>
        <p class="text-center text-sm text-gray-400">
            <a href="#" id="toggle-auth" class="font-medium text-blue-400 hover:text-blue-300">
                Don't have an account? Sign up
            </a>
        </p>
    </div>

    <!-- Game Section -->
    <div id="game-container" class="hidden w-full h-full flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-6xl flex justify-between items-center mb-4 p-2 bg-black bg-opacity-20 rounded-lg">
            <div><span class="text-lg">Welcome, <span id="user-email" class="font-bold"></span></span></div>
            <div class="text-lg">Balance: <span id="user-balance" class="font-bold text-yellow-400">0</span></div>
            <button id="logout-btn" class="px-4 py-2 bg-rose-600 hover:bg-rose-700 rounded-md font-semibold shadow-lg">Logout</button>
        </div>
        <div class="w-full max-w-6xl flex-grow flex flex-col lg:flex-row items-center justify-around bg-gray-800 rounded-lg shadow-2xl p-6">
            <div class="flex flex-col items-center justify-center">
                <h2 class="text-3xl font-bold mb-4 text-shadow">Place Your Bet</h2>
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <div id="wheel" class="wheel"></div>
                </div>
            </div>
            <div class="w-full lg:w-1/2 mt-8 lg:mt-0 lg:ml-8 flex flex-col">
                <h3 class="text-2xl font-semibold mb-2 text-center">Select up to 5 Numbers</h3>
                <p class="text-center text-gray-400 mb-4">Total Bet: <span id="total-bet-display" class="font-bold text-yellow-400">0</span></p>
                <div id="number-grid" class="grid grid-cols-10 gap-2 mb-4"></div>
                <div class="space-y-4 mt-auto">
                    <input type="number" id="bet-amount" placeholder="Enter bet amount per number" class="w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="place-bet-btn" class="w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-md text-lg font-bold transition duration-200 disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed shadow-lg pulse-animation">
                        Spin the Wheel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="message-modal" class="message-modal">
        <div id="message-box" class="bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
            <p id="message-text" class="text-xl mb-6"></p>
            <button id="message-close-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-semibold">Close</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJ9K9fQ0ThMB7aXB6qNHr3_yLUdqJgnCM",
            authDomain: "my-chain-reaction-game.firebaseapp.com",
            projectId: "my-chain-reaction-game",
            storageBucket: "my-chain-reaction-game.appspot.com",
            messagingSenderId: "32751418407",
            appId: "1:32751418407:web:ff8244007ef2b099d56202",
            measurementId: "G-D6ZRG8LK2H"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        const gameContainer = document.getElementById('game-container');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const toggleAuthLink = document.getElementById('toggle-auth');
        const authTitle = document.getElementById('auth-title');
        const logoutBtn = document.getElementById('logout-btn');
        const userEmailEl = document.getElementById('user-email');
        const userBalanceEl = document.getElementById('user-balance');
        const wheel = document.getElementById('wheel');
        const numberGrid = document.getElementById('number-grid');
        const betAmountInput = document.getElementById('bet-amount');
        const placeBetBtn = document.getElementById('place-bet-btn');
        const totalBetDisplay = document.getElementById('total-bet-display');
        const messageModal = document.getElementById('message-modal');
        const messageText = document.getElementById('message-text');
        const messageCloseBtn = document.getElementById('message-close-btn');

        // Game state
        let currentUser = null;
        let currentUserData = null;
        let selectedNumbers = [];
        const MAX_BETS = 5;
        let isSpinning = false;
        let unsubscribeUserDoc = null;

        // --- UTILITY & VISUALS ---
        function showMessage(text, type = 'info') {
            messageText.textContent = text;
            const messageBox = document.getElementById('message-box');
            messageBox.className = 'bg-gray-800 rounded-lg shadow-xl p-8 max-w-sm w-full text-center transform transition-transform duration-300 scale-95';
            if (type === 'success') messageBox.classList.add('border-t-4', 'border-green-500');
            else if (type === 'error') messageBox.classList.add('border-t-4', 'border-red-500');
            messageModal.classList.add('visible');
            setTimeout(() => messageBox.classList.remove('scale-95'), 10);
        }
        messageCloseBtn.addEventListener('click', () => messageModal.classList.remove('visible'));

        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let confettiParticles = [];

        function runConfetti() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
            for(let i=0; i<150; i++) {
                confettiParticles.push({
                    x: Math.random() * confettiCanvas.width,
                    y: Math.random() * confettiCanvas.height - confettiCanvas.height,
                    size: Math.random() * 5 + 2,
                    speed: Math.random() * 5 + 2,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    angle: Math.random() * 2 * Math.PI,
                    spin: (Math.random() - 0.5) * 0.2
                });
            }
            let animationFrame;
            function animateConfetti() {
                confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
                confettiParticles.forEach((p, i) => {
                    p.y += p.speed;
                    p.x += Math.sin(p.angle);
                    p.angle += p.spin;
                    confettiCtx.fillStyle = p.color;
                    confettiCtx.beginPath();
                    confettiCtx.fillRect(p.x, p.y, p.size, p.size * 2);
                    confettiCtx.fill();
                    if(p.y > confettiCanvas.height) confettiParticles.splice(i, 1);
                });
                if (confettiParticles.length > 0) {
                    animationFrame = requestAnimationFrame(animateConfetti);
                } else {
                    cancelAnimationFrame(animationFrame);
                    confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
                }
            }
            animateConfetti();
        }

        // --- AUTHENTICATION ---
        toggleAuthLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
            const isLogin = !loginForm.classList.contains('hidden');
            authTitle.textContent = isLogin ? 'Sign in to your account' : 'Create a new account';
            toggleAuthLink.textContent = isLogin ? 'Don\'t have an account? Sign up' : 'Already have an account? Sign in';
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = registerForm.email.value;
            const password = registerForm.password.value;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, "users", userCredential.user.uid), { email: userCredential.user.email, balance: 1000 });
                showMessage('Account created successfully!', 'success');
            } catch (error) {
                showMessage(error.code === 'auth/email-already-in-use' ? 'This email is already registered.' : 'Error: ' + error.message, 'error');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            try { await signInWithEmailAndPassword(auth, loginForm.email.value, loginForm.password.value); } 
            catch (error) { showMessage('Failed to sign in. Please check your credentials.', 'error'); }
        });

        logoutBtn.addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                authContainer.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                userEmailEl.textContent = user.email;
                if (unsubscribeUserDoc) unsubscribeUserDoc();
                const userDocRef = doc(db, "users", user.uid);
                unsubscribeUserDoc = onSnapshot(userDocRef, (doc) => {
                    if (doc.exists()) {
                        currentUserData = doc.data();
                        userBalanceEl.textContent = currentUserData.balance.toLocaleString();
                    }
                });
            } else {
                currentUser = null; currentUserData = null;
                authContainer.classList.remove('hidden');
                gameContainer.classList.add('hidden');
                if (unsubscribeUserDoc) unsubscribeUserDoc();
            }
        });

        // --- GAME LOGIC ---
        function generateWheel() {
            const radius = 170; // radius of the wheel
            const angleStep = 360 / 50;
            for (let i = 1; i <= 50; i++) {
                const angle = (i - 1) * angleStep;
                const numberEl = document.createElement('div');
                numberEl.className = 'wheel-number';
                numberEl.textContent = i;
                numberEl.dataset.number = i;
                
                // Position numbers around the circle using trigonometry
                const x = radius * Math.cos((angle - 90) * (Math.PI / 180));
                const y = radius * Math.sin((angle - 90) * (Math.PI / 180));
                
                // Use CSS variables for transform to make winner animation easier
                numberEl.style.setProperty('--tx', `${x}px`);
                numberEl.style.setProperty('--ty', `${y}px`);
                numberEl.style.transform = `translate(${x}px, ${y}px)`;
                
                // Color alternating numbers for visual appeal
                if(i % 2 === 0) {
                    numberEl.style.backgroundColor = '#4b5563'; // gray-600
                } else {
                    numberEl.style.backgroundColor = '#1a202c'; // gray-900
                }
                
                wheel.appendChild(numberEl);
            }
        }

        function generateNumberGrid() {
            for (let i = 1; i <= 50; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.dataset.number = i;
                btn.className = 'number-grid-btn p-2 border-2 border-gray-600 rounded-md hover:bg-blue-700';
                btn.addEventListener('click', () => selectNumber(i, btn));
                numberGrid.appendChild(btn);
            }
        }

        function updateTotalBet() {
            const betAmount = parseInt(betAmountInput.value) || 0;
            const totalBet = betAmount * selectedNumbers.length;
            totalBetDisplay.textContent = totalBet.toLocaleString();
        }
        betAmountInput.addEventListener('input', updateTotalBet);

        function selectNumber(num, btn) {
            if (isSpinning) return;
            const index = selectedNumbers.indexOf(num);
            if (index > -1) {
                selectedNumbers.splice(index, 1);
                btn.classList.remove('selected');
            } else {
                if (selectedNumbers.length < MAX_BETS) {
                    selectedNumbers.push(num);
                    btn.classList.add('selected');
                } else {
                    showMessage(`You can select a maximum of ${MAX_BETS} numbers.`, 'error');
                }
            }
            updateTotalBet();
        }

        placeBetBtn.addEventListener('click', async () => {
            if (isSpinning) return;
            const betAmount = parseInt(betAmountInput.value);
            const totalBet = betAmount * selectedNumbers.length;

            if (selectedNumbers.length === 0) return showMessage('Please select at least one number.', 'error');
            if (isNaN(betAmount) || betAmount <= 0) return showMessage('Please enter a valid bet amount.', 'error');
            if (totalBet > currentUserData.balance) return showMessage('Your balance is too low for this total bet.', 'error');

            isSpinning = true;
            placeBetBtn.disabled = true;
            placeBetBtn.classList.remove('pulse-animation');
            placeBetBtn.textContent = 'Spinning...';

            const newBalance = currentUserData.balance - totalBet;
            const userDocRef = doc(db, "users", currentUser.uid);
            await setDoc(userDocRef, { balance: newBalance }, { merge: true });

            const winningNumber = Math.floor(Math.random() * 50) + 1;
            const degreesPerNumber = 7.2;
            const randomOffset = (Math.random() - 0.5) * degreesPerNumber * 0.8;
            const targetAngle = (winningNumber - 1) * degreesPerNumber + randomOffset;
            const extraRevolutions = (Math.floor(Math.random() * 4) + 5) * 360;
            const finalRotation = extraRevolutions + (360 - targetAngle);
            wheel.style.transform = `rotate(${finalRotation}deg)`;
            
            setTimeout(async () => {
                let finalBalance = newBalance;
                const didWin = selectedNumbers.includes(winningNumber);
                
                document.querySelectorAll('.wheel-number').forEach(n => n.classList.remove('winner'));
                const winnerEl = document.querySelector(`.wheel-number[data-number='${winningNumber}']`);
                if(winnerEl) winnerEl.classList.add('winner');

                if (didWin) {
                    const winnings = betAmount * 10;
                    finalBalance += winnings;
                    showMessage(`Winner! The number was ${winningNumber}. You won ${winnings.toLocaleString()}!`, 'success');
                    runConfetti();
                } else {
                    showMessage(`Sorry, the winning number was ${winningNumber}. You lost ${totalBet.toLocaleString()}.`, 'error');
                }

                await setDoc(userDocRef, { balance: finalBalance }, { merge: true });

                isSpinning = false;
                placeBetBtn.disabled = false;
                placeBetBtn.classList.add('pulse-animation');
                placeBetBtn.textContent = 'Spin the Wheel';
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${finalRotation % 360}deg)`;
                setTimeout(() => { wheel.style.transition = 'transform 5s cubic-bezier(0.25, 1, 0.5, 1)'; }, 50);
                
                selectedNumbers = [];
                document.querySelectorAll('.number-grid-btn').forEach(btn => btn.classList.remove('selected'));
                updateTotalBet();

            }, 5500);
        });

        generateWheel();
        generateNumberGrid();
    </script>
</body>
</html>
